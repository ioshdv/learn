<div class="detail-container">
    <img src="{{producto.imagen}}" class="detail-image">
    <div>
        <h1>{{producto.nombre}}</h1>
        <p style="color:#27ae60; font-size:1.5rem; font-weight:bold;">${{producto.precio}}</p>
        <p><strong>Categoría:</strong> {{producto.categoria}}</p>
        <p>{{producto.descripcion}}</p>
        <hr>
        <h3>Comentarios</h3>
        <div id="comments">
            {{#each comentarios}}
            <div style="background:#eee; padding:10px; margin-bottom:5px; border-radius:5px;">
                <strong>@{{usuario}}:</strong> {{texto}}
            </div>
            {{/each}}
        </div>
        
        {{#if user}}
        <div style="margin-top:20px; background:#f0f7ff; padding:15px; border-radius:8px;">
            <h4>Deja un comentario:</h4>
            <textarea id="com-txt" style="width:100%; height:60px;"></textarea><br>
            <button onclick="enviarComentario()" class="btn">Publicar</button>
        </div>
        {{/if}}

        <br>
        <a href="/" class="btn" style="background:#95a5a6;">← Volver al Catálogo</a>
    </div>
</div>

<script>
async function enviarComentario() {
    const texto = document.getElementById('com-txt').value;
    const productoId = window.location.pathname.split('/')[2];
    if(!texto) return;

    const res = await fetch('/api/comentarios', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ productoId, texto })
    });
    if(res.ok) window.location.reload();
}
</script>